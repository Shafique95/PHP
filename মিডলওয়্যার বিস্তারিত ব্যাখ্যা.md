# PHP

# ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржмрзНржпрж╛ржЦрзНржпрж╛

ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░ ржмрзЛржЭрж╛ ржПржХржЯрзБ ржХржарж┐ржи ржоржирзЗ рж╣рждрзЗ ржкрж╛рж░рзЗ, ржХрж┐ржирзНрждрзБ ржЖржорж┐ ржПржХржЯрж┐ ржоржЬрж╛рж░ ржЙржжрж╛рж╣рж░ржгрзЗрж░ ржорж╛ржзрзНржпржорзЗ ржПржЯрж┐ ржмрзНржпрж╛ржЦрзНржпрж╛ ржХрж░ржмред

## ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░ ржХрж┐?

ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░ рж╣рж▓рзЛ ржПржоржи ржПржХ ржХрзЛржб ржпрж╛ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗ HTTP рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржЖрж╕рж╛рж░ ржкрж░ ржПржмржВ рж░рзЗрж╕ржкржирзНрж╕ ржкрж╛ржарж╛ржирзЛрж░ ржЖржЧрзЗ ржорж╛ржЭржЦрж╛ржирзЗ ржХрж╛ржЬ ржХрж░рзЗред ржПржЯрж┐ ржпрзЗржи ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржжрж░ржЬрж╛рж░ ржжрж╛рж░рзЛржпрж╝рж╛ржи!

## ржоржЬрж╛рж░ ржЙржжрж╛рж╣рж░ржг: рж░рзЗрж╕рзНржЯрзБрж░рзЗржирзНржЯ ржжрж╛рж░рзЛржпрж╝рж╛ржи

ржЪрж▓рзБржи ржХрж▓рзНржкржирж╛ ржХрж░рж┐ ржПржХржЯрж┐ ржЦрзБржм ржЬржиржкрзНрж░рж┐ржпрж╝ рж░рзЗрж╕рзНржЯрзБрж░рзЗржирзНржЯ ржЖржЫрзЗ ржпрзЗржЦрж╛ржирзЗ ржмрж┐ржнрж┐ржирзНржи ржзрж░ржирзЗрж░ ржнрж┐ржЖржЗржкрж┐ рж▓рзЛржХ ржЖрж╕рзЗред рж░рзЗрж╕рзНржЯрзБрж░рзЗржирзНржЯрзЗрж░ ржжрж░ржЬрж╛ржпрж╝ ржПржХржЬржи ржжрж╛рж░рзЛржпрж╝рж╛ржи ржЖржЫрзЗ (ржПржЯрж╛ржЗ ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░!)ред

### ржжрж╛рж░рзЛржпрж╝рж╛ржирзЗрж░ (ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░рзЗрж░) ржХрж╛ржЬ:

1. **ржЕржерзЗржиржЯрж┐ржХрзЗрж╢ржи ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░** - ржжрж╛рж░рзЛржпрж╝рж╛ржи ржжрзЗржЦрзЗ ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ ржнрж╛рж▓рж┐ржб ржЯрж┐ржХрзЗржЯ ржЖржЫрзЗ ржХрж┐ ржирж╛
2. **рж░рзЛрж▓ ржЪрзЗржХ ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░** - ржжрж╛рж░рзЛржпрж╝рж╛ржи ржжрзЗржЦрзЗ ржЖржкржирж┐ ржХрж┐ ржнрж┐ржЖржЗржкрж┐, рж░рзЗржЧрзБрж▓рж╛рж░ ржЧрзЗрж╕рзНржЯ, ржмрж╛ рж╕рзНржЯрж╛ржл
3. **ржерзНрж░ржЯрж▓рж┐ржВ ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░** - ржПржХржмрж╛рж░рзЗ ржЦрзБржм ржмрзЗрж╢рж┐ рж▓рзЛржХ ржврзБржХрждрзЗ ржЪрж╛ржЗрж▓рзЗ ржжрж╛рж░рзЛржпрж╝рж╛ржи "ржПржХржЯрзБ ржзрзИрж░рзНржп ржзрж░рзБржи" ржмрж▓рзЗ рж▓рж╛ржЗржи ржХрж░рж╛ржпрж╝

## ржХрзЛржбрзЗ ржЙржжрж╛рж╣рж░ржг:

### рзз. ржкрж╛рж░рзНржЯрж┐ ржЪрзЗржХрж╛рж░ ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░

```php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;

class PartyChecker
{
   public function handle(Request $request, Closure $next)
   {
       // ржЪрзЗржХ ржХрж░ржЫрж┐ ржмрзНржпржХрзНрждрж┐ ржкрж╛рж░рзНржЯрж┐рждрзЗ ржЖрж╕рждрзЗ ржкрж╛рж░ржмрзЗ ржХрж┐ржирж╛
       if (!$request->has('invitation')) {
           // ржХрзЛржирзЛ ржирж┐ржоржирзНрждрзНрж░ржг ржирзЗржЗ! ржлрж┐рж░рж┐ржпрж╝рзЗ ржжрж┐ржи
           return redirect('/sorry')->with('message', 'ржЖржкржирж╛рж░ ржирж┐ржоржирзНрждрзНрж░ржг ржХрзЛржерж╛ржпрж╝? ЁЯзР');
       }
      
       // ржпржжрж┐ ржирж┐ржоржирзНрждрзНрж░ржг ржерж╛ржХрзЗ, ржкрж░ржмрж░рзНрждрзА ржзрж╛ржкрзЗ ржпрж╛ржУржпрж╝рж╛рж░ ржЕржирзБржорждрж┐ ржжрж┐ржи
       return $next($request);
   }
}
```

### рзи. ржбрзНрж░рзЗрж╕ ржХрзЛржб ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░

```php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;

class DressCodeChecker
{
   public function handle(Request $request, Closure $next)
   {
       $dressCode = $request->input('dress_code');
      
       // ржбрзНрж░рзЗрж╕ ржХрзЛржб ржЪрзЗржХ ржХрж░ржЫрж┐
       if ($dressCode !== 'formal') {
           // ржкрзЛрж╢рж╛ржХ ржарж┐ржХ ржирзЗржЗ!
           return redirect('/change-clothes')->with('message', 'рж╕рж░рж┐! ржлрж░ржорж╛рж▓ ржбрзНрж░рзЗрж╕ ржЫрж╛ржбрж╝рж╛ ржкрзНрж░ржмрзЗрж╢ ржирж┐рж╖рзЗржз ЁЯСФ');
       }
      
       // ржкрзЛрж╢рж╛ржХ ржарж┐ржХ ржЖржЫрзЗ, ржкрж░ржмрж░рзНрждрзА ржзрж╛ржкрзЗ ржпрж╛ржУржпрж╝рж╛рж░ ржЕржирзБржорждрж┐ ржжрж┐ржи
       return $next($request);
   }
}
```

## ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░ рж░рзЗржЬрж┐рж╕рзНржЯрж╛рж░ ржХрж░рж╛

`app/Http/Kernel.php` ржлрж╛ржЗрж▓рзЗ ржЖржкржирж╛рж░ ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░ рж░рзЗржЬрж┐рж╕рзНржЯрж╛рж░ ржХрж░рзБржи:

```php
protected $routeMiddleware = [
   // рж▓рж╛рж░рж╛ржнрзЗрж▓рзЗрж░ ржмрж┐рж▓рзНржЯ-ржЗржи ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░
   'auth' => \App\Http\Middleware\Authenticate::class,
   'guest' => \App\Http\Middleware\RedirectIfAuthenticated::class,
  
   // ржЖржкржирж╛рж░ ржХрж╛рж╕рзНржЯржо ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░
   'party.check' => \App\Http\Middleware\PartyChecker::class,
   'dress.code' => \App\Http\Middleware\DressCodeChecker::class,
];
```

## рж░рж╛ржЙржЯрзЗ ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░ ржмрзНржпржмрж╣рж╛рж░

```php
// ржПржХржЯрж┐ рж░рж╛ржЙржЯрзЗ ржПржХржЯрж┐ ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░
Route::get('/vip-lounge', [PartyController::class, 'vipArea'])
   ->middleware('party.check');

// ржПржХржЯрж┐ рж░рж╛ржЙржЯрзЗ ржПржХрж╛ржзрж┐ржХ ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░
Route::get('/exclusive-party', [PartyController::class, 'exclusiveParty'])
   ->middleware(['party.check', 'dress.code']);

// ржЧрзЛржЯрж╛ ржЧрзНрж░рзБржкрзЗрж░ ржЬржирзНржп ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░
Route::middleware(['party.check'])->group(function () {
   Route::get('/dance-floor', [PartyController::class, 'danceFloor']);
   Route::get('/buffet', [PartyController::class, 'buffet']);
});
```

## ржоржЬрж╛рж░ ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг: "ржорж╛ржорж╛рж░ ржмрж╛ржбрж╝рж┐рж░ ржкрж╛рж░рзНржЯрж┐"

ржоржирзЗ ржХрж░рзБржи ржЖржкржирж┐ ржПржХржЯрж┐ ржУржпрж╝рзЗржмрж╕рж╛ржЗржЯ ржмрж╛ржирж╛ржЪрзНржЫрзЗржи ржпрзЗржЦрж╛ржирзЗ ржорж╛ржорж╛рж░ ржмрж╛ржбрж╝рж┐рж░ ржкрж╛рж░рзНржЯрж┐ ржЧрзЗрж╕рзНржЯ рж▓рж┐рж╕рзНржЯ ржорзНржпрж╛ржирзЗржЬ ржХрж░рж╛ рж╣ржпрж╝ред ржкрж╛рж░рзНржЯрж┐рждрзЗ ржврзЛржХрж╛рж░ рж╕ржоржпрж╝ ржХржпрж╝рзЗржХржЯрж┐ ржЪрзЗржХ ржХрж░рж╛ ржжрж░ржХрж╛рж░:

1. **FamilyMemberCheck**: ржЖржкржирж┐ ржЖрж╕рж▓рзЗржЗ ржкрж░рж┐ржмрж╛рж░рзЗрж░ рж╕ржжрж╕рзНржп ржХрж┐ржирж╛
2. **GiftChecker**: ржЖржкржирж┐ ржЙржкрж╣рж╛рж░ ржирж┐ржпрж╝рзЗ ржПрж╕рзЗржЫрзЗржи ржХрж┐ржирж╛
3. **FoodAllergiesCheck**: ржЖржкржирж╛рж░ ржХрзЛржи ржлрзБржб ржЕрзНржпрж╛рж▓рж╛рж░рзНржЬрж┐ ржЖржЫрзЗ ржХрж┐ржирж╛ ржпрзЗржи ржЦрж╛ржмрж╛рж░ ржорзНржпрж╛ржирзЗржЬ ржХрж░рж╛ ржпрж╛ржпрж╝

```php
// ржорж╛ржорж╛рж░ ржкрж╛рж░рзНржЯрж┐ ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░
public function enterParty(Request $request)
{
   return view('party.welcome', [
       'message' => 'рж╕рзНржмрж╛ржЧрждржо ржорж╛ржорж╛рж░ ржмрж╛ржбрж╝рж┐рж░ ржкрж╛рж░рзНржЯрж┐рждрзЗ! ЁЯОЙ'
   ]);
}

// рж░рж╛ржЙржЯ ржбрзЗржлрж┐ржирж┐рж╢ржи
Route::get('/mamas-party', [PartyController::class, 'enterParty'])
   ->middleware(['family.check', 'gift.check', 'allergy.check']);
```

ржПржЦржи, `FamilyMemberCheck` ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░рзЗрж░ ржХрзЛржб:

```php
public function handle(Request $request, Closure $next)
{
   $familyMembers = ['рж░рж╛ржЬрзБ', 'рж╕рзБржоржи', 'ржХржмрж┐рж░', 'рж░рзБржорж╛', 'рж▓рж┐ржЬрж╛'];
  
   if (!in_array($request->input('name'), $familyMembers)) {
       return redirect('/outsider')->with('message',
           'ржЖржкржирж┐ ржХрзЗ? ржорж╛ржорж╛ ржЖржкржирж╛ржХрзЗ ржЪрж┐ржирзЗржи ржирж╛! ЁЯдФ');
   }
  
   // ржЖржЪрзНржЫрж╛ ржарж┐ржХ ржЖржЫрзЗ, ржкрж░рж┐ржмрж╛рж░рзЗрж░ рж▓рзЛржХред ржпрзЗрждрзЗ ржжрж┐ржи!
   return $next($request);
}
```

## ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░рзЗрж░ ржкрзНржпрж╛рж░рж╛ржорж┐ржЯрж╛рж░ ржмрзНржпржмрж╣рж╛рж░

рж╕ржоржпрж╝рзЗ рж╕ржоржпрж╝рзЗ ржЖржкржирж╛рж░ ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░рзЗ ржкрзНржпрж╛рж░рж╛ржорж┐ржЯрж╛рж░ ржкрж╛ржарж╛ржирзЛ ржжрж░ржХрж╛рж░ рж╣рждрзЗ ржкрж╛рж░рзЗ:

```php
// AgeChecker ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░
public function handle(Request $request, Closure $next, $minimumAge)
{
   if ($request->input('age') < $minimumAge) {
       return redirect('/too-young')->with('message',
           "ржжрзБржГржЦрж┐ржд! ржЖржкржирж╛рж░ ржмржпрж╝рж╕ {$request->input('age')} ржмржЫрж░, ржХрж┐ржирзНрждрзБ ржПржЦрж╛ржирзЗ ржкрзНрж░ржмрзЗрж╢рзЗрж░ ржЬржирзНржп ржХржоржкржХрзНрж╖рзЗ {$minimumAge} ржмржЫрж░ рж▓рж╛ржЧржмрзЗ! ЁЯС╢");
   }
  
   return $next($request);
}

// рж░рж╛ржЙржЯрзЗ ржмрзНржпржмрж╣рж╛рж░
Route::get('/adult-party', [PartyController::class, 'adultParty'])
   ->middleware('age.check:18');  // 18 ржкрзНржпрж╛рж░рж╛ржорж┐ржЯрж╛рж░ рж╣рж┐рж╕рзЗржмрзЗ ржкрж╛ржарж╛ржирзЛ рж╣ржЪрзНржЫрзЗ
```

## ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░ ржерзЗржХрзЗ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рж╛

ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░рзЗ ржПржХржЗ ржХрж╛ржЬ ржжрзБржмрж╛рж░ ржХрж░рж╛ ржпрж╛ржпрж╝ - рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрзНрж░рж╕рзЗрж╕ рж╣ржУржпрж╝рж╛рж░ ржЖржЧрзЗ ржПржмржВ рж░рзЗрж╕ржкржирзНрж╕ рждрзИрж░рж┐ рж╣ржУржпрж╝рж╛рж░ ржкрж░рзЗ:

```php
public function handle(Request $request, Closure $next)
{
   // рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрзНрж░рж╕рзЗрж╕ рж╣ржУржпрж╝рж╛рж░ ржЖржЧрзЗ ржПржЗ ржХрзЛржб рж░рж╛ржи рж╣ржмрзЗ
   $startTime = microtime(true);
  
   // ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржорзЗржержбрзЗ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрж╛ржарж╛ржирзЛ
   $response = $next($request);
  
   // рж░рзЗрж╕ржкржирзНрж╕ рждрзИрж░рж┐ рж╣ржУржпрж╝рж╛рж░ ржкрж░рзЗ ржПржЗ ржХрзЛржб рж░рж╛ржи рж╣ржмрзЗ
   $endTime = microtime(true);
   $executionTime = $endTime - $startTime;
  
   // рж░рзЗрж╕ржкржирзНрж╕рзЗ ржПржХржЯрж┐ рж╣рзЗржбрж╛рж░ ржпрзЛржЧ ржХрж░рж╛
   $response->header('X-Execution-Time', $executionTime);
  
   return $response;
}
```

## рж╢рзЗрж╖ ржХржерж╛

ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░ рж╣рж▓рзЛ рж▓рж╛рж░рж╛ржнрзЗрж▓рзЗрж░ ржПржХржЯрж┐ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА ржлрж┐ржЪрж╛рж░ ржпрж╛ ржЖржкржирж┐ ржмрж┐ржнрж┐ржирзНржи ржзрж░ржирзЗрж░ ржлрж┐рж▓рзНржЯрж╛рж░ рж╣рж┐рж╕рзЗржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред ржПржЯрж┐ ржЖржкржирж╛рж░ ржХрзЛржбржХрзЗ ржкрж░рж┐рж╖рзНржХрж╛рж░, ржкрзБржирж░рж╛ржпрж╝ ржмрзНржпржмрж╣рж╛рж░ржпрзЛржЧрзНржп ржПржмржВ ржнрж╛рж▓ржнрж╛ржмрзЗ рж╕ржВржЧржарж┐ржд рж░рж╛ржЦрждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗред

